{{ if eq .chezmoi.os "darwin" -}}
#!/usr/bin/env zsh

###############################
#
# Inspired by:
# - https://wilsonmar.github.io/dotfiles/
# - https://github.com/palnabarun/dotfiles/blob/main/defaults.sh
# - https://macos-defaults.com/
#
###############################

# Ask for the administrator password upfront
sudo -v

# Keep-alive: update existing `sudo` time stamp until `.macos` has finished
while true; do
  sudo -n true
  sleep 60
  kill -0 "$$" || exit
done 2>/dev/null &

#### System

# Set computer name (as done via System Preferences â†’ Sharing)
sudo scutil --set ComputerName "${COMPUTER_NAME}"
sudo scutil --set HostName "${COMPUTER_NAME}"
sudo scutil --set LocalHostName "${COMPUTER_NAME}"
sudo defaults write /Library/Preferences/SystemConfiguration/com.apple.smb.server NetBIOSName -string "${COMPUTER_NAME}"

#### Dock

defaults write com.apple.dock "orientation" -string "right"
defaults write com.apple.dock "tilesize" -int "32"
defaults write com.apple.dock "autohide" -bool "true"
defaults write com.apple.dock "autohide-time-modifier" -float "0"
defaults write com.apple.dock "autohide-delay" -float "0"
defaults write com.apple.dock "show-recents" -bool "false"
defaults write com.apple.dock "mineffect" -string "scale"
defaults write com.apple.dock "no-bouncing" -bool "true"

## Hot corners

defaults write com.apple.dock "wvous-tl-corner" -int "5"         # Start screen saver
defaults write com.apple.dock "wvous-tl-modifier" -int "1048576" # Cmd
defaults write com.apple.dock "wvous-tr-corner" -int "4"         # Show desktop
defaults write com.apple.dock "wvous-tr-modifier" -int "1048576" # Cmd
defaults write com.apple.dock "wvous-br-corner" -int "1"         # Nothing
defaults write com.apple.dock "wvous-br-modifier" -int "0"       # no-op
defaults write com.apple.dock "wvous-bl-corner" -int "10"        # Put display to sleep
defaults write com.apple.dock "wvous-bl-modifier" -int "0"       # no-op

#### Finder

defaults write NSGlobalDomain "AppleShowAllExtensions" -bool "true"
defaults write NSGlobalDomain "NSDocumentSaveNewDocumentsToCloud" -bool "false"
defaults write NSGlobalDomain "NSToolbarTitleViewRolloverDelay" -float "0"

defaults write com.apple.finder "AppleShowAllFiles" -bool "true"
defaults write com.apple.finder "ShowPathbar" -bool "true"
defaults write com.apple.finder "_FXSortFoldersFirst" -bool "true"
defaults write com.apple.finder "FXDefaultSearchScope" -string "SCcf" # current folder
defaults write com.apple.finder "FXRemoveOldTrashItems" -bool "true"
defaults write com.apple.finder "ShowStatusBar" -bool "true"

## Desktop

defaults write com.apple.finder "_FXSortFoldersFirstOnDesktop" -bool "true"
defaults write com.apple.finder "CreateDesktop" -bool "false"
defaults write com.apple.finder "ShowHardDrivesOnDesktop" -bool "false"
defaults write com.apple.finder "ShowExternalHardDrivesOnDesktop" -bool "false"
defaults write com.apple.finder "ShowRemovableMediaOnDesktop" -bool "false"
defaults write com.apple.finder "ShowMountedServersOnDesktop" -bool "false"

#### Menubar

defaults write com.apple.menuextra.clock "ShowAMPM" -bool "false"
defaults write com.apple.menuextra.clock "ShowDate" -bool "false"
defaults write com.apple.menuextra.clock "ShowDayOfWeek" -bool "false"

#### Trackpad

defaults write NSGlobalDomain "com.apple.swipescrolldirection" -bool "false" # inverted

defaults write com.apple.AppleMultitouchTrackpad "FirstClickThreshold" -int "0"

#### Keyboard

defaults write NSGlobalDomain "ApplePressAndHoldEnabled" -bool "false"
defaults write NSGlobalDomain "AppleKeyboardUIMode" -int "2" # enable

defaults write com.apple.HIToolbox "AppleFnUsageType" -int "0" # do nothing

# Key rate
# https://apple.stackexchange.com/a/83923
defaults write -g "InitialKeyRepeat" -float "15.0" # 15 (225 ms)
defaults write -g "KeyRepeat" -float "1.5"         # 2 (30 ms)

#### Misson Control

defaults write com.apple.dock "mru-spaces" -bool "false" # Space auto arrange
defaults write com.apple.dock "expose-group-apps" -bool "true"
defaults write NSGlobalDomain "AppleSpacesSwitchOnActivate" -bool "true"

##### Finder

# Show the ~/Library folder
chflags nohidden ~/Library

# Show the /Volumes folder
sudo chflags nohidden /Volumes

# Avoid creating .DS_Store files on network or USB volumes
defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true
defaults write com.apple.desktopservices DSDontWriteUSBStores -bool true

#### Miscellaneous

# Enable the expand save panel by default
defaults write NSGlobalDomain NSNavPanelExpandedStateForSaveMode -bool true
defaults write NSGlobalDomain NSNavPanelExpandedStateForSaveMode2 -bool true

# Expand print panel by default
defaults write NSGlobalDomain PMPrintingExpandedStateForPrint -bool true
defaults write NSGlobalDomain PMPrintingExpandedStateForPrint2 -bool true

# Apple Intelligense
defaults write com.apple.CloudSubscriptionFeatures.optIn "545129924" -bool "false"

# Disable Animations
# https://apple.stackexchange.com/a/63477

# NOTE: disable command
# defaults delete <option value>

killall Dock

killall Finder

{{- end }}
